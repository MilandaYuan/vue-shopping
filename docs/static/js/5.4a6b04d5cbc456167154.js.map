{"version":3,"sources":["webpack:///src/components/List.vue","webpack:///./src/components/List.vue?5d77","webpack:///./src/components/List.vue"],"names":["List","param","getData","_this","this","scroll","offsetTop","distance","pageY","start","move","end","timerUp","id","_this2","timer","_$refs$scroll","$refs","_this3","isLoading","offset","hasMore","books","length","_this4","MHeader","components_List","render","_vm","_h","$createElement","_c","_self","_v","ref","staticClass","on","loadMore","_l","book","index","key","attrs","to","name","params","bid","bookId","tag","directives","rawName","value","expression","alt","_s","bookName","bookInfo","_f","bookPrice","click","$event","stopPropagation","remove","addToCart","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"qNAgCAA,mBAEA,0DAGAC,6BAIAC,kDAKA,WACA,aAEA,uBAEA,IAAAC,EAAAC,kBACAC,WACAC,UACAC,OAAA,KACA,sGAIAC,yBAEA,qBAEAA,WACAC,2BAGA,QAEA,oBACA,yCAGAC,oCACAC,kEAgBA,uBARAC,WACA,oCACAF,oCACAC,yBAEA,WACA,SACAT,aAGA,kBACA,MAEA,oCAEAQ,iCACAC,2EAOAE,wBAEA,IAAAC,EAAAV,qHACAW,qCACA,IAAAC,EAAAF,EAAAG,MACAZ,uDAEAH,WAEA,qEAEA,IAAAgB,EAAAd,iIACAe,UAAA,qCACA,yBACAC,wDACAC,qCACAC,qBACAC,oBAEA,oEAEA,IAAAC,EAAApB,kIACAS,+DACAA,+DAOAY,UAAA,KCpIAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAAxB,KAAayB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAAA,EAAA,WAAAH,EAAAK,GAAA,QAAAL,EAAAK,GAAA,KAAAF,EAAA,OAAoEG,IAAA,SAAAC,YAAA,UAAAC,IAAuC/B,OAAAuB,EAAAS,YAAuBN,EAAA,KAAAH,EAAAU,GAAAV,EAAA,eAAAW,EAAAC,GAAkD,OAAAT,EAAA,eAAyBU,IAAAD,EAAAE,OAAiBC,IAAMC,KAAA,SAAAC,QAAsBC,IAAAP,EAAAQ,SAAiBC,IAAA,QAAajB,EAAA,OAAYI,YAAA,kBAA4BJ,EAAA,OAAYkB,aAAaL,KAAA,OAAAM,QAAA,SAAAC,MAAAZ,EAAA,UAAAa,WAAA,mBAAgFV,OAASW,IAAA,QAAUzB,EAAAK,GAAA,KAAAF,EAAA,OAA0BI,YAAA,mBAA6BJ,EAAA,MAAAH,EAAAK,GAAAL,EAAA0B,GAAAf,EAAAgB,aAAA3B,EAAAK,GAAA,KAAAF,EAAA,KAAAH,EAAAK,GAAAL,EAAA0B,GAAAf,EAAAiB,aAAA5B,EAAAK,GAAA,KAAAF,EAAA,KAAAH,EAAAK,GAAAL,EAAA0B,GAAA1B,EAAA6B,GAAA,UAAA7B,CAAAW,EAAAmB,UAAA,OAAA9B,EAAAK,GAAA,KAAAF,EAAA,OAAAA,EAAA,UAA4MI,YAAA,SAAAC,IAAyBuB,MAAA,SAAAC,GAAyBA,EAAAC,kBAAyBjC,EAAAkC,OAAAvB,EAAAQ,YAA0BnB,EAAAK,GAAA,QAAAL,EAAAK,GAAA,KAAAF,EAAA,UAA0CI,YAAA,SAAAC,IAAyBuB,MAAA,SAAAC,GAAyBA,EAAAC,kBAAyBjC,EAAAmC,UAAAxB,EAAAQ,YAA6BnB,EAAAK,GAAA,iBAAuBL,EAAAK,GAAA,KAAAL,EAAA,QAAAG,EAAA,OAAuCI,YAAA,UAAAC,IAA0BuB,MAAA/B,EAAA1B,WAAqB0B,EAAAK,GAAA,aAAAF,EAAA,OAAgCI,YAAA,YAAsBP,EAAAK,GAAA,kBAEjqC+B,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACAnE,EACA0B,GATA,EAVA,SAAA0C,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,QAAAJ,EAAA","file":"static/js/5.4a6b04d5cbc456167154.js","sourcesContent":["<template>\r\n  <div>\r\n    <MHeader>列表</MHeader>\r\n    <div class=\"content\" ref=\"scroll\" @scroll='loadMore'>\r\n      <ul>\r\n        <router-link :to=\"{name:'detail',params:{bid:book.bookId}}\" v-for=\"(book,index) in books\" :key=\"index\" tag=\"li\">\r\n          <div class=\"img-container\">\r\n            <img v-lazy=\"book.bookCover\" alt=\"\">\r\n          </div>\r\n          <div class=\"info-container\">\r\n            <h3>{{book.bookName}}</h3>\r\n            <p>{{book.bookInfo}}</p>\r\n            <b>{{book.bookPrice | toFixed(2)}}</b>\r\n            <div>\r\n              <button class=\"button\" @click.stop=\"remove(book.bookId)\">删除</button>\r\n              <button class=\"button\" @click.stop=\"addToCart(book.bookId)\">添加</button>\r\n            </div>\r\n\r\n          </div>\r\n        </router-link>\r\n      </ul>\r\n      <div @click='getData' v-if=\"hasMore\" class=\"loading\">正在加载...</div>\r\n      <div v-else class=\"no-more\">没有啦~~</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import MHeader from '../base/MHeader'\r\n  import {pagination, removeBook} from \"../api\";\r\n  import * as Types from '../store/mutations-type'\r\n\r\n  export default {\r\n    name: \"list\",\r\n    filters: {\r\n      toFixed(number, param) {\r\n        return '￥' + number.toFixed(param)\r\n      }\r\n    },\r\n    created() {\r\n      this.getData();\r\n    },\r\n    data() {\r\n      return {\r\n        books: [],\r\n        offset: 0,\r\n        hasMore: true,\r\n        isLoading: false\r\n      }\r\n    },\r\n    mounted() {\r\n      let scroll = this.$refs.scroll;\r\n      let top = scroll.offsetTop;\r\n      let distance;\r\n      let isMove = false\r\n      scroll.addEventListener('touchstart', (e) => {\r\n        if (scroll.offsetTop !== top || scroll.scrollTop !== 0) return\r\n       // console.log('start')\r\n        let start = e.touches[0].pageY;\r\n        let move = (e) => {\r\n          isMove = true;\r\n         // console.log('move')\r\n          let current = e.touches[0].pageY;\r\n          distance = current - start;\r\n          if (distance > 0) {\r\n            if (distance <= 50) {\r\n              scroll.style.top = top + distance + 'px';\r\n            } else {\r\n              distance = 50;\r\n              scroll.style.top = 50 + top + 'px'\r\n            }\r\n          } else {\r\n            scroll.removeEventListener('touchmove', move)\r\n            scroll.removeEventListener('touchend', end)\r\n          }\r\n        }\r\n        let end = (e) => {\r\n          if(!isMove) return\r\n          //clearInterval(this.timerUp)\r\n          this.timerUp = setInterval(() => {\r\n            if (distance <= 0) {\r\n              clearInterval(this.timerUp)\r\n              distance = 0;\r\n              scroll.removeEventListener('touchmove', move)\r\n              scroll.removeEventListener('touchend', end)\r\n              this.books = [];\r\n              this.hasMore = true;\r\n              this.offset = 0;\r\n              this.getData()\r\n              return\r\n            }\r\n            distance -= 1;\r\n            scroll.style.top = top + distance + 'px';\r\n          }, 1)\r\n\r\n        }\r\n        scroll.addEventListener('touchmove', move)\r\n        scroll.addEventListener('touchend', end)\r\n      })\r\n    },\r\n\r\n    methods: {\r\n      addToCart(id){\r\n        //this.$store.commit(Types.ADD_TO_CART,book)\r\n        this.$store.dispatch('increaseCount',id)\r\n      },\r\n      async loadMore() {\r\n        clearTimeout(this.timer)\r\n        this.timer = setTimeout(() => {\r\n          let {scrollTop, clientHeight, scrollHeight} = this.$refs.scroll;\r\n          if (scrollTop + clientHeight + 20 > scrollHeight) {\r\n            this.getData()\r\n          }\r\n        }, 60)\r\n      },\r\n      async getData() {\r\n        if (this.hasMore && !this.isLoading) {\r\n          this.isLoading = true\r\n          let {hasMore, books} = await  pagination(this.offset)\r\n          this.hasMore = hasMore;\r\n          this.books = [...this.books, ...books]\r\n          this.offset = this.books.length;\r\n          this.isLoading = false\r\n        }\r\n      },\r\n      async remove(id) {\r\n        await removeBook(id)\r\n        this.books = this.books.filter(item => item.bookId !== id)\r\n        //this.getData()\r\n      }\r\n    },\r\n    components: {\r\n      MHeader\r\n    }\r\n\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  .content {\r\n    ul {\r\n      padding: 10px;\r\n\r\n      li {\r\n        display: flex;\r\n        padding: 10px 0;\r\n       // border-bottom: 1px solid #ccc;\r\n        .img-container {\r\n          width: 45%;\r\n          img {\r\n            max-width: 100%;\r\n          }\r\n        }\r\n        .info-container {\r\n          width: 50%;\r\n          padding-left: 5%;\r\n          line-height: 25px;\r\n          p{\r\n            padding-bottom: 5px;\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n    .loading  {\r\n      text-align: center;\r\n      color: gray;\r\n    }\r\n    .no-more{\r\n      text-align: center;\r\n      color: gray;\r\n    }\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/List.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('MHeader',[_vm._v(\"列表\")]),_vm._v(\" \"),_c('div',{ref:\"scroll\",staticClass:\"content\",on:{\"scroll\":_vm.loadMore}},[_c('ul',_vm._l((_vm.books),function(book,index){return _c('router-link',{key:index,attrs:{\"to\":{name:'detail',params:{bid:book.bookId}},\"tag\":\"li\"}},[_c('div',{staticClass:\"img-container\"},[_c('img',{directives:[{name:\"lazy\",rawName:\"v-lazy\",value:(book.bookCover),expression:\"book.bookCover\"}],attrs:{\"alt\":\"\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"info-container\"},[_c('h3',[_vm._v(_vm._s(book.bookName))]),_vm._v(\" \"),_c('p',[_vm._v(_vm._s(book.bookInfo))]),_vm._v(\" \"),_c('b',[_vm._v(_vm._s(_vm._f(\"toFixed\")(book.bookPrice,2)))]),_vm._v(\" \"),_c('div',[_c('button',{staticClass:\"button\",on:{\"click\":function($event){$event.stopPropagation();_vm.remove(book.bookId)}}},[_vm._v(\"删除\")]),_vm._v(\" \"),_c('button',{staticClass:\"button\",on:{\"click\":function($event){$event.stopPropagation();_vm.addToCart(book.bookId)}}},[_vm._v(\"添加\")])])])])})),_vm._v(\" \"),(_vm.hasMore)?_c('div',{staticClass:\"loading\",on:{\"click\":_vm.getData}},[_vm._v(\"正在加载...\")]):_c('div',{staticClass:\"no-more\"},[_vm._v(\"没有啦~~\")])])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-019153e6\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/List.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-019153e6\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./List.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./List.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./List.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-019153e6\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./List.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-019153e6\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/List.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}